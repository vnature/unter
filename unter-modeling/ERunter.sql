CREATE SCHEMA UNTER;
SET SCHEMA UNTER;

/* Drop Tables */

DROP TABLE CARRIER_SELECTION_SLOT;
DROP TABLE LOADING_SLOTS;
DROP TABLE ORDERS;
DROP TABLE CARRIERS;
DROP TABLE GATES;
DROP TABLE WAREHOUSES;




/* Create Tables */

CREATE TABLE CARRIERS
(
	CARRIER_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	NAME varchar(100) NOT NULL UNIQUE,
	PRIMARY KEY (CARRIER_ID)
);


CREATE TABLE CARRIER_SELECTION_SLOT
(
	CARRIER_SELECTION_SLOT_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	LOADING_SLOT_ID bigint NOT NULL,
	TIME_FROM time NOT NULL,
	TIME_TILL time NOT NULL,
	GATE_ID bigint NOT NULL,
	PRIMARY KEY (CARRIER_SELECTION_SLOT_ID)
);


CREATE TABLE GATES
(
	GATE_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	WAREHOUSE_ID bigint NOT NULL,
	NAME varchar(100) NOT NULL UNIQUE,
	PRIMARY KEY (GATE_ID)
);


CREATE TABLE LOADING_SLOTS
(
	LOADING_SLOT_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	WAREHOUSE_ID bigint NOT NULL,
	ORDER_ID bigint NOT NULL,
	FROM_TIME timestamp NOT NULL,
	TILL_TIME timestamp NOT NULL,
	PRIMARY KEY (LOADING_SLOT_ID)
);


CREATE TABLE ORDERS
(
	ORDER_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	ORDER_NUMBER varchar(36) UNIQUE,
	CARRIER_ID bigint NOT NULL,
	PRIMARY KEY (ORDER_ID)
);


CREATE TABLE WAREHOUSES
(
	WAREHOUSE_ID bigint NOT NULL GENERATED ALWAYS AS IDENTITY ,
	NAME varchar(100) NOT NULL UNIQUE,
	PRIMARY KEY (WAREHOUSE_ID)
);



/* Create Foreign Keys */

ALTER TABLE ORDERS
	ADD FOREIGN KEY (CARRIER_ID)
	REFERENCES CARRIERS (CARRIER_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CARRIER_SELECTION_SLOT
	ADD FOREIGN KEY (GATE_ID)
	REFERENCES GATES (GATE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE CARRIER_SELECTION_SLOT
	ADD FOREIGN KEY (LOADING_SLOT_ID)
	REFERENCES LOADING_SLOTS (LOADING_SLOT_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE LOADING_SLOTS
	ADD FOREIGN KEY (ORDER_ID)
	REFERENCES ORDERS (ORDER_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE GATES
	ADD FOREIGN KEY (WAREHOUSE_ID)
	REFERENCES WAREHOUSES (WAREHOUSE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE LOADING_SLOTS
	ADD FOREIGN KEY (WAREHOUSE_ID)
	REFERENCES WAREHOUSES (WAREHOUSE_ID)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;



